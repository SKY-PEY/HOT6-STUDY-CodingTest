# Ch06. 백트래킹 알고리즘

- 모든 경우의 수를 고려해야할 때 첫 번째로 접근해볼만한 알고리즘

​

## 백트래킹 알고리즘이란?

- 그래프/트리의 모든 원소를 완전 탐색하기 위한 목적으로 사용

- DFS와의 차이는 다음과 같다.

  - DFS는 일반적으로 완전 탐색 목적으로, 재귀 함수를 이용해 구현한다.

  - 백트래킹도 재귀함수를 이용해 구현하는 것이 일반적이지만, 단순히 완전탐색하는 것이 아니라 조건에 따라서 유망한 노드로 이동한다.

<br/>

### 그래프 표현 방식

<img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMjA4/MDAxNjk2OTkyNzI2NjI1.hDSCGF9VYrS45woeNi4ixpU_B2xzltw6OTNL9FpdhLEg.MkXdEI-F_WCTPe1KDd2B70h_F2A6rtFQ8MdFpTcsbyEg.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.28.19.png?type=w773">

<br/>

### 백트래킹 이해하기 - N-Queen 문제

- N x N 체스 보드 위에 퀸 N개가 서로 공격할 수 없게 놓는 문제.
  <img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMTI1/MDAxNjk2OTkyNzM2Mjg4.42J_O1JL1c2D5LPGYduGug9eDcZsXRPVEH3PgFKumfAg.zMWw5en3P-w9V0_GZSTYAI81dNPc0izCUVfi7Sl6MZgg.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.30.52.png?type=w773">

- 퀸이 서로를 공격할 수 없는 경우는 다음과 같다.
  <img src="https://postfiles.pstatic.net/MjAyMzEwMTFfNzkg/MDAxNjk2OTkyNzQ1NjI4.vVqXlu2ngKsabR6CS4uDJ3M9lmbpomft-2tB2RxW_xIg.GK7obD5nvc6BRG7TGhkYmEP38-nzRusG2jwlwBieX1Ag.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.31.46.png?type=w773">

### 문제해결 아이디어

- 즉 이러한 경우가 총 몇개 존재하는지와 같은 문제가 백트래킹 문제이다.
  <img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMTk1/MDAxNjk2OTkyNzUzMjQ5.OzSr9Wi4SjJXM8HicAST4KAfowsX5MPrWrPlxRc1LzQg.aKUk2V2pGT9LX8DBFwJ9KTaYNJgF_ySt_uo8SYNuY0gg.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.33.05.png?type=w773">

<img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMjQ3/MDAxNjk2OTkyNzU2NDA1.VLL-wVaRcvGtlGGyYH44Hjs7ulmyURVUDiwQCC2b1N8g.lFzsQHa_fahNCMsCy60LReVbjOKiLNbxLVJzMoiIzI4g.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.33.51.png?type=w773">

### 위를 트리 구조로 표현하면 이해가 쉽다.

<img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMzUg/MDAxNjk2OTkyNzY0NDA1.TBXXpW7BevglBH_6FEvDrJHHWI2gX_i7pHLGvsSmztUg.0nuxynY7qxe_eO7dagbSs29_3ZLQYU1ot21PrqS5HIIg.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.34.38.png?type=w773">

- 백트래킹을 진행할 때는 위와 같이 경우의 수를 최대한 줄일 수 있다.

- 즉 이전까지 놓았던 퀸들과 상충되지 않는 조건을 만족하는 위치에 대해서만 재귀함수를 호출하는 것이다.

  - 재귀함수를 통해 모든 경우의 수를 다 찾은 뒤에, 각 경우마다 가능한지 검사하는 방법이 있을 수 있다.

  - 유망한 경우에 대해서만 재귀 함수를 호출하는 방법이 있을 수 있다.

- 위의 퀸 문제는 두 번째 방법인 유망한 경우에 대해서만 재귀 함수를 호출하는 것이 더 효율적이다. (모든 경우가 너무 많기 때문에)
  ​

### 백트래킹 기본 형태(일반적인 코드 형태)

<img src="https://postfiles.pstatic.net/MjAyMzEwMTFfMTU1/MDAxNjk2OTkyNzczNzMw.ADsYl_FAJLthd0pWuHacIfjpaHKtZiDHzvJFmsZKk-4g.CY1p-Owjc3UOdlvCeSHvsutybILYT-eCPTcMTHlxrAEg.PNG.dnrwls6505/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2023-10-11_%EC%98%A4%EC%A0%84_11.37.26.png?type=w773">

### N-Queen 해결 아이디어

- N-Queen 문제는 위의 경우(일반적인 백트래킹은 가능한 모든 노드에 재귀함수를 호출)와 다르게 매 재귀함수마다 N x N 모든 위치를 모두 볼 필요 X

- 맨 처음 행부터 차례대로 퀸을 놓는다고 생각하면 가짓수를 줄일 수 있다.

- 뿐만 아니라 현재 행의 이전 행으로 돌아갈 필요가 없다.

- 백트래킹은 모든 경우의 수를 탐색하기에 적합하지만, N-Queen 문제는 특정 위치(노드)의 가능 여부를 판단하면 된다.

- 가능한 노드 여부는 다음의 두 가지를 확인해야 한다.

- 같은 행에 있는지 체크 : x1 == x2 / 같은 열에 있는지 체크 : y1 == y2

- 대각선에 있는지 체크 : abs(x1, x2) == abs(y1, y2)

​

### N-Queen 해결 코드

```js
let n = 8; // 전체 맵(map)의 크기
let queens = []; // 현재 체스판에 놓인 퀸의 위치 정보들

// 조건에 따른 완전탐색을 수행하기 위한 조건 함수
function possible(x, y) {
  // (x, y) 위치에 퀸을 놓을 수 있는지 확인
  for (let [a, b] of queens) {
    // 현재까지 놓았던 모든 퀸의 위치를 하나씩 확인하며
    if (a == x || b == y) return false; // 행이나 열이 같다면 놓을 수 없음(루트 => 자식 노드로 가야하므로)
    if (Math.abs(a - x) == Math.abs(b - y)) return false; // 대각선에 위치한 경우 놓을 수 없음(루트 => 자식 노드로 가야하므로)
  }
  return true;
}

let cnt = 0;

// 완전탐색
function dfs(row) {
  if (row == n) cnt += 1; // 퀸을 N개 배치할 수 있는 경우 카운트
  for (let i = 0; i < n; i++) {
    // 현재 행에 존재하는 열을 하나씩 확인
    if (!possible(row, i)) continue; // 현재 위치에 놓을 수 없다면 무시
    queens.push([row, i]); // 현재 위치에 퀸 놓기
    dfs(row + 1); // 재귀 함수 호출
    queens.pop(); // 현재 위치에서 퀸 제거
  }
}

dfs(0);

console.log(cnt);
```
